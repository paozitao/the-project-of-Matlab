clc,clear;
% t=0:0.0005:1/10;
Fs=4096;
N=2048;

fm1=30;
fm2=60;
fm3=120;
fc1=300;
fc2=600;
fc3=1200;
% xt=cos(2*fm1*pi*t).*cos(2*pi*fc1*t)+cos(2*fm2*pi*t).*cos(2*pi*fc2*t)+cos(2*fm3*pi*t).*cos(2*pi*fc3*t);
% plot(t,xt);
% title('st在0.1s内的时域波形图');
% xlabel('t');
% ylabel('st');
t=0:1/Fs:(N-1)/Fs;
st1=cos(2*fm1*pi*t).*cos(2*pi*fc1*t);
st2=cos(2*fm2*pi*t).*cos(2*pi*fc2*t);
st3=cos(2*fm3*pi*t).*cos(2*pi*fc3*t);
st=st1+st2+st3;
% Xk=fft(xt,N);%fft得到频谱图
% k=0:N-1;
% w=k/N*Fs;
% plot(w,abs(Xk)/max(abs(Xk)));
% title('st的幅频特性曲线（归一化）');
% xlabel('f/Hz');
% ylabel('Xk');
rp=0.1;
rs=60;
wp1=0.17;ws1=0.2;
wp21=0.22;wp22=0.37;ws21=0.2;ws22=0.38;
wp2=[wp21,wp22];ws2=[ws21,ws22];
wp3=0.48;ws3=0.47;
[N1,wc1]=ellipord(wp1,ws1,rp,rs);
[N2,wc2]=ellipord(wp2,ws2,rp,rs);
[N3,wc3]=ellipord(wp3,ws3,rp,rs);
[Bz1,Az1]=ellip(N1,rp,rs,wp1);
[Bz2,Az2]=ellip(N2,rp,rs,wp2);
[Bz3,Az3]=ellip(N3,rp,rs,wp3,'high');
[H1,w1]=freqz(Bz1,Az1,N1);
[H2,w2]=freqz(Bz2,Az2,N2);
[H3,w3]=freqz(Bz3,Az3,N3);
figure(1);
yt1=filter(Bz1,Az1,st);
yt2=filter(Bz2,Az2,st);
yt3=filter(Bz3,Az3,st);
subplot(311);
plot(t,yt1);
title('通过低通滤波器后的St');
grid on;
subplot(312);
plot(t,yt2);
title('通过带通滤波器后的St');
grid on;
subplot(313);
plot(t,yt3);
title('通过高通滤波器后的St');
grid on;
figure(2)
subplot(311);
plot(w1/pi,20*log10(abs(H1)/max(abs(H1))));
title('低通滤波器的损耗函数');
xlabel('w/pi');
ylabel('幅度/dB');
grid on;
subplot(312);
plot(w2/pi,20*log10(abs(H2)/max(abs(H2))));
title('带通滤波器的损耗函数');
xlabel('w/pi');
ylabel('幅度/dB');
grid on;
subplot(313);
plot(w3/pi,20*log10(abs(H3)/max(abs(H3))));
title('高通滤波器的损耗函数');
xlabel('w/pi');
ylabel('幅度/dB');
grid on;